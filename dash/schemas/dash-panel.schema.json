{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://dash.dev/schema/panel.json",
  "title": "Dash Panel Configuration Schema",
  "description": "Schema definition for Dash panel YAML configuration files",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "panel": {
      "type": "object",
      "description": "Core panel settings",
      "additionalProperties": false,
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for this panel",
          "pattern": "^[a-z][a-z0-9_-]*$",
          "default": "admin"
        },
        "path": {
          "type": "string",
          "description": "Base URL path where the panel is mounted",
          "pattern": "^/[a-z0-9/_-]*$",
          "default": "/admin"
        }
      }
    },
    "storage": {
      "type": "object",
      "description": "Storage configuration for file uploads",
      "additionalProperties": false,
      "properties": {
        "basePath": {
          "type": "string",
          "description": "Base directory path for all storage operations",
          "default": "storage"
        },
        "defaultDisk": {
          "type": "string",
          "description": "The default disk to use for storage operations",
          "default": "public"
        },
        "disks": {
          "type": "object",
          "description": "Named storage disk configurations",
          "additionalProperties": {
            "$ref": "#/$defs/disk"
          }
        }
      }
    },
    "session": {
      "type": "object",
      "description": "Session storage configuration",
      "additionalProperties": false,
      "properties": {
        "driver": {
          "type": "string",
          "description": "Session storage driver",
          "enum": ["file", "memory"],
          "default": "file"
        },
        "path": {
          "type": "string",
          "description": "Path for file-based session storage (relative to storage.basePath)",
          "default": "sessions"
        }
      }
    },
    "database": {
      "type": "object",
      "description": "Database connection configuration",
      "additionalProperties": false,
      "required": ["driver"],
      "properties": {
        "driver": {
          "type": "string",
          "description": "Database driver to use",
          "enum": ["sqlite", "postgres", "mysql"]
        },
        "path": {
          "type": "string",
          "description": "Database file path for SQLite (relative to storage.basePath)"
        },
        "host": {
          "type": "string",
          "description": "Database host for network-based drivers"
        },
        "port": {
          "type": "integer",
          "description": "Database port for network-based drivers"
        },
        "database": {
          "type": "string",
          "description": "Database name for network-based drivers"
        },
        "username": {
          "type": "string",
          "description": "Database username"
        },
        "password": {
          "type": "string",
          "description": "Database password"
        },
        "migrations": {
          "type": "object",
          "description": "Migration configuration",
          "additionalProperties": false,
          "properties": {
            "auto": {
              "type": "boolean",
              "description": "Whether to automatically run migrations on connect",
              "default": true
            },
            "verbose": {
              "type": "boolean",
              "description": "Whether to output verbose migration logs",
              "default": false
            }
          }
        }
      },
      "allOf": [
        {
          "if": {
            "properties": { "driver": { "const": "sqlite" } }
          },
          "then": {
            "required": ["path"]
          }
        },
        {
          "if": {
            "properties": { "driver": { "enum": ["postgres", "mysql"] } }
          },
          "then": {
            "required": ["host", "database"]
          }
        }
      ]
    }
  },
  "$defs": {
    "disk": {
      "type": "object",
      "description": "Storage disk configuration",
      "additionalProperties": false,
      "required": ["driver"],
      "properties": {
        "driver": {
          "type": "string",
          "description": "Storage driver type",
          "enum": ["local"],
          "default": "local"
        },
        "path": {
          "type": "string",
          "description": "Directory path for local storage (relative to storage.basePath)"
        },
        "urlPrefix": {
          "type": "string",
          "description": "URL prefix for accessing files publicly"
        },
        "visibility": {
          "type": "string",
          "description": "Default visibility for uploaded files",
          "enum": ["public", "private"],
          "default": "public"
        }
      }
    }
  }
}
